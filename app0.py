import streamlit as st
import google.generativeai as genai
from datetime import date, datetime, timedelta
from io import BytesIO
from docx import Document
from docx.enum.text import WD_ALIGN_PARAGRAPH

# -------------------------------------------------------------------------
# [0. ì‹œìŠ¤í…œ ì„¤ì • ë° ì„¸ì…˜ ì´ˆê¸°í™”]
# -------------------------------------------------------------------------
st.set_page_config(page_title="AI ë²•ë¥  ë§ˆìŠ¤í„° (ë¬´ê²°ì„± ì™„ì „íŒ)", page_icon="âš–ï¸", layout="wide")

if 'rec_court' not in st.session_state: st.session_state['rec_court'] = "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›"
if 'amt_in' not in st.session_state: st.session_state['amt_in'] = "30000000"

# -------------------------------------------------------------------------
# [1. ë°ì´í„°ë² ì´ìŠ¤: ì „êµ­ ë²•ì› ë° ì „êµ­ 226ê°œ ê¸°ì´ˆì§€ìì²´ ì™„ë²½ ë§¤í•‘]
# -------------------------------------------------------------------------
COURT_LIST = [
    "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›", "ì„œìš¸ë™ë¶€ì§€ë°©ë²•ì›", "ì„œìš¸ë‚¨ë¶€ì§€ë°©ë²•ì›", "ì„œìš¸ë¶ë¶€ì§€ë°©ë²•ì›", "ì„œìš¸ì„œë¶€ì§€ë°©ë²•ì›",
    "ì˜ì •ë¶€ì§€ë°©ë²•ì›", "ì˜ì •ë¶€ì§€ë°©ë²•ì› ê³ ì–‘ì§€ì›", "ì˜ì •ë¶€ì§€ë°©ë²•ì› ë‚¨ì–‘ì£¼ì§€ì›",
    "ì¸ì²œì§€ë°©ë²•ì›", "ì¸ì²œì§€ë°©ë²•ì› ë¶€ì²œì§€ì›",
    "ìˆ˜ì›ì§€ë°©ë²•ì›", "ìˆ˜ì›ì§€ë°©ë²•ì› ì„±ë‚¨ì§€ì›", "ìˆ˜ì›ì§€ë°©ë²•ì› ì—¬ì£¼ì§€ì›", "ìˆ˜ì›ì§€ë°©ë²•ì› í‰íƒì§€ì›", "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì‚°ì§€ì›", "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì–‘ì§€ì›",
    "ì¶˜ì²œì§€ë°©ë²•ì›", "ì¶˜ì²œì§€ë°©ë²•ì› ê°•ë¦‰ì§€ì›", "ì¶˜ì²œì§€ë°©ë²•ì› ì›ì£¼ì§€ì›", "ì¶˜ì²œì§€ë°©ë²•ì› ì†ì´ˆì§€ì›", "ì¶˜ì²œì§€ë°©ë²•ì› ì˜ì›”ì§€ì›",
    "ëŒ€ì „ì§€ë°©ë²•ì›", "ëŒ€ì „ì§€ë°©ë²•ì› ì²œì•ˆì§€ì›", "ëŒ€ì „ì§€ë°©ë²•ì› ì„œì‚°ì§€ì›", "ëŒ€ì „ì§€ë°©ë²•ì› í™ì„±ì§€ì›", "ëŒ€ì „ì§€ë°©ë²•ì› ë…¼ì‚°ì§€ì›", "ëŒ€ì „ì§€ë°©ë²•ì› ê³µì£¼ì§€ì›",
    "ì²­ì£¼ì§€ë°©ë²•ì›", "ì²­ì£¼ì§€ë°©ë²•ì› ì¶©ì£¼ì§€ì›", "ì²­ì£¼ì§€ë°©ë²•ì› ì œì²œì§€ì›", "ì²­ì£¼ì§€ë°©ë²•ì› ì˜ë™ì§€ì›",
    "ëŒ€êµ¬ì§€ë°©ë²•ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› í¬í•­ì§€ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› ê¹€ì²œì§€ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› ì•ˆë™ì§€ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› ê²½ì£¼ì§€ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› ìƒì£¼ì§€ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› ì˜ì„±ì§€ì›", "ëŒ€êµ¬ì§€ë°©ë²•ì› ì˜ë•ì§€ì›",
    "ë¶€ì‚°ì§€ë°©ë²•ì›", "ë¶€ì‚°ì§€ë°©ë²•ì› ë™ë¶€ì§€ì›", "ë¶€ì‚°ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›",
    "ìš¸ì‚°ì§€ë°©ë²•ì›", "ì°½ì›ì§€ë°©ë²•ì›", "ì°½ì›ì§€ë°©ë²•ì› ë§ˆì‚°ì§€ì›", "ì°½ì›ì§€ë°©ë²•ì› ì§„ì£¼ì§€ì›", "ì°½ì›ì§€ë°©ë²•ì› í†µì˜ì§€ì›", "ì°½ì›ì§€ë°©ë²•ì› ë°€ì–‘ì§€ì›", "ì°½ì›ì§€ë°©ë²•ì› ê±°ì°½ì§€ì›",
    "ê´‘ì£¼ì§€ë°©ë²•ì›", "ê´‘ì£¼ì§€ë°©ë²•ì› ìˆœì²œì§€ì›", "ê´‘ì£¼ì§€ë°©ë²•ì› ëª©í¬ì§€ì›", "ê´‘ì£¼ì§€ë°©ë²•ì› ì¥í¥ì§€ì›", "ê´‘ì£¼ì§€ë°©ë²•ì› í•´ë‚¨ì§€ì›",
    "ì „ì£¼ì§€ë°©ë²•ì›", "ì „ì£¼ì§€ë°©ë²•ì› êµ°ì‚°ì§€ì›", "ì „ì£¼ì§€ë°©ë²•ì› ì •ìì§€ì›", "ì „ì£¼ì§€ë°©ë²•ì› ë‚¨ì›ì§€ì›", "ì œì£¼ì§€ë°©ë²•ì›"
]

# ì „êµ­ ê¸°ì´ˆìì¹˜ë‹¨ì²´ ì „ì²´ ë§¤í•‘ (ìƒëµ ì—†ìŒ)
JURISDICTION_MAP = {
    # --- ìˆ˜ë„ê¶Œ ---
    "ì¢…ë¡œ": "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›", "ì¤‘êµ¬": "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›", "ê°•ë‚¨": "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›", "ì„œì´ˆ": "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›", "ê´€ì•…": "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›", "ë™ì‘": "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›",
    "ì„±ë™": "ì„œìš¸ë™ë¶€ì§€ë°©ë²•ì›", "ê´‘ì§„": "ì„œìš¸ë™ë¶€ì§€ë°©ë²•ì›", "ê°•ë™": "ì„œìš¸ë™ë¶€ì§€ë°©ë²•ì›", "ì†¡íŒŒ": "ì„œìš¸ë™ë¶€ì§€ë°©ë²•ì›",
    "ì˜ë“±í¬": "ì„œìš¸ë‚¨ë¶€ì§€ë°©ë²•ì›", "ê°•ì„œ": "ì„œìš¸ë‚¨ë¶€ì§€ë°©ë²•ì›", "ì–‘ì²œ": "ì„œìš¸ë‚¨ë¶€ì§€ë°©ë²•ì›", "êµ¬ë¡œ": "ì„œìš¸ë‚¨ë¶€ì§€ë°©ë²•ì›", "ê¸ˆì²œ": "ì„œìš¸ë‚¨ë¶€ì§€ë°©ë²•ì›",
    "ë™ëŒ€ë¬¸": "ì„œìš¸ë¶ë¶€ì§€ë°©ë²•ì›", "ì¤‘ë‘": "ì„œìš¸ë¶ë¶€ì§€ë°©ë²•ì›", "ì„±ë¶": "ì„œìš¸ë¶ë¶€ì§€ë°©ë²•ì›", "ë„ë´‰": "ì„œìš¸ë¶ë¶€ì§€ë°©ë²•ì›", "ê°•ë¶": "ì„œìš¸ë¶ë¶€ì§€ë°©ë²•ì›", "ë…¸ì›": "ì„œìš¸ë¶ë¶€ì§€ë°©ë²•ì›",
    "ì€í‰": "ì„œìš¸ì„œë¶€ì§€ë°©ë²•ì›", "ì„œëŒ€ë¬¸": "ì„œìš¸ì„œë¶€ì§€ë°©ë²•ì›", "ë§ˆí¬": "ì„œìš¸ì„œë¶€ì§€ë°©ë²•ì›", "ìš©ì‚°": "ì„œìš¸ì„œë¶€ì§€ë°©ë²•ì›",
    "ê³ ì–‘": "ì˜ì •ë¶€ì§€ë°©ë²•ì› ê³ ì–‘ì§€ì›", "íŒŒì£¼": "ì˜ì •ë¶€ì§€ë°©ë²•ì› ê³ ì–‘ì§€ì›", "ë‚¨ì–‘ì£¼": "ì˜ì •ë¶€ì§€ë°©ë²•ì› ë‚¨ì–‘ì£¼ì§€ì›", "êµ¬ë¦¬": "ì˜ì •ë¶€ì§€ë°©ë²•ì› ë‚¨ì–‘ì£¼ì§€ì›", "ê°€í‰": "ì˜ì •ë¶€ì§€ë°©ë²•ì› ë‚¨ì–‘ì£¼ì§€ì›",
    "ë¶€ì²œ": "ì¸ì²œì§€ë°©ë²•ì› ë¶€ì²œì§€ì›", "ê¹€í¬": "ì¸ì²œì§€ë°©ë²•ì› ë¶€ì²œì§€ì›", "ì¸ì²œ": "ì¸ì²œì§€ë°©ë²•ì›", "ê°•í™”": "ì¸ì²œì§€ë°©ë²•ì›", "ì˜¹ì§„": "ì¸ì²œì§€ë°©ë²•ì›",
    "ì„±ë‚¨": "ìˆ˜ì›ì§€ë°©ë²•ì› ì„±ë‚¨ì§€ì›", "í•˜ë‚¨": "ìˆ˜ì›ì§€ë°©ë²•ì› ì„±ë‚¨ì§€ì›", "ê´‘ì£¼": "ìˆ˜ì›ì§€ë°©ë²•ì› ì„±ë‚¨ì§€ì›",
    "ì•ˆì‚°": "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì‚°ì§€ì›", "ê´‘ëª…": "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì‚°ì§€ì›", "ì‹œí¥": "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì‚°ì§€ì›",
    "ì•ˆì–‘": "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì–‘ì§€ì›", "ê³¼ì²œ": "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì–‘ì§€ì›", "ì˜ì™•": "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì–‘ì§€ì›", "êµ°í¬": "ìˆ˜ì›ì§€ë°©ë²•ì› ì•ˆì–‘ì§€ì›",
    "í‰íƒ": "ìˆ˜ì›ì§€ë°©ë²•ì› í‰íƒì§€ì›", "ì•ˆì„±": "ìˆ˜ì›ì§€ë°©ë²•ì› í‰íƒì§€ì›", "ì—¬ì£¼": "ìˆ˜ì›ì§€ë°©ë²•ì› ì—¬ì£¼ì§€ì›", "ì´ì²œ": "ìˆ˜ì›ì§€ë°©ë²•ì› ì—¬ì£¼ì§€ì›", "ì–‘í‰": "ìˆ˜ì›ì§€ë°©ë²•ì› ì—¬ì£¼ì§€ì›",
    "ìˆ˜ì›": "ìˆ˜ì›ì§€ë°©ë²•ì›", "ìš©ì¸": "ìˆ˜ì›ì§€ë°©ë²•ì›", "í™”ì„±": "ìˆ˜ì›ì§€ë°©ë²•ì›", "ì˜¤ì‚°": "ìˆ˜ì›ì§€ë°©ë²•ì›",

    # --- ê°•ì›ë„ ---
    "ì¶˜ì²œ": "ì¶˜ì²œì§€ë°©ë²•ì›", "í™ì²œ": "ì¶˜ì²œì§€ë°©ë²•ì›", "ì–‘êµ¬": "ì¶˜ì²œì§€ë°©ë²•ì›", "ì¸ì œ": "ì¶˜ì²œì§€ë°©ë²•ì›", "í™”ì²œ": "ì¶˜ì²œì§€ë°©ë²•ì›",
    "ê°•ë¦‰": "ì¶˜ì²œì§€ë°©ë²•ì› ê°•ë¦‰ì§€ì›", "ë™í•´": "ì¶˜ì²œì§€ë°©ë²•ì› ê°•ë¦‰ì§€ì›", "ì‚¼ì²™": "ì¶˜ì²œì§€ë°©ë²•ì› ê°•ë¦‰ì§€ì›",
    "ì›ì£¼": "ì¶˜ì²œì§€ë°©ë²•ì› ì›ì£¼ì§€ì›", "íš¡ì„±": "ì¶˜ì²œì§€ë°©ë²•ì› ì›ì£¼ì§€ì›", "ì†ì´ˆ": "ì¶˜ì²œì§€ë°©ë²•ì› ì†ì´ˆì§€ì›", "ì–‘ì–‘": "ì¶˜ì²œì§€ë°©ë²•ì› ì†ì´ˆì§€ì›", "ê³ ì„±": "ì¶˜ì²œì§€ë°©ë²•ì› ì†ì´ˆì§€ì›",
    "ì˜ì›”": "ì¶˜ì²œì§€ë°©ë²•ì› ì˜ì›”ì§€ì›", "íƒœë°±": "ì¶˜ì²œì§€ë°©ë²•ì› ì˜ì›”ì§€ì›", "ì •ì„ ": "ì¶˜ì²œì§€ë°©ë²•ì› ì˜ì›”ì§€ì›",

    # --- ì¶©ì²­ë„ ---
    "ì²œì•ˆ": "ëŒ€ì „ì§€ë°©ë²•ì› ì²œì•ˆì§€ì›", "ì•„ì‚°": "ëŒ€ì „ì§€ë°©ë²•ì› ì²œì•ˆì§€ì›", "ì„œì‚°": "ëŒ€ì „ì§€ë°©ë²•ì› ì„œì‚°ì§€ì›", "ë‹¹ì§„": "ëŒ€ì „ì§€ë°©ë²•ì› ì„œì‚°ì§€ì›", "íƒœì•ˆ": "ëŒ€ì „ì§€ë°©ë²•ì› ì„œì‚°ì§€ì›",
    "í™ì„±": "ëŒ€ì „ì§€ë°©ë²•ì› í™ì„±ì§€ì›", "ë³´ë ¹": "ëŒ€ì „ì§€ë°©ë²•ì› í™ì„±ì§€ì›", "ì˜ˆì‚°": "ëŒ€ì „ì§€ë°©ë²•ì› í™ì„±ì§€ì›", "ë…¼ì‚°": "ëŒ€ì „ì§€ë°©ë²•ì› ë…¼ì‚°ì§€ì›", "ê³„ë£¡": "ëŒ€ì „ì§€ë°©ë²•ì› ë…¼ì‚°ì§€ì›", "ë¶€ì—¬": "ëŒ€ì „ì§€ë°©ë²•ì› ë…¼ì‚°ì§€ì›",
    "ê³µì£¼": "ëŒ€ì „ì§€ë°©ë²•ì› ê³µì£¼ì§€ì›", "ì²­ì–‘": "ëŒ€ì „ì§€ë°©ë²•ì› ê³µì£¼ì§€ì›", "ëŒ€ì „": "ëŒ€ì „ì§€ë°©ë²•ì›", "ì„¸ì¢…": "ëŒ€ì „ì§€ë°©ë²•ì›",
    "ì²­ì£¼": "ì²­ì£¼ì§€ë°©ë²•ì›", "ì§„ì²œ": "ì²­ì£¼ì§€ë°©ë²•ì›", "ë³´ì€": "ì²­ì£¼ì§€ë°©ë²•ì›", "ê´´ì‚°": "ì²­ì£¼ì§€ë°©ë²•ì›", "ì¦í‰": "ì²­ì£¼ì§€ë°©ë²•ì›",
    "ì¶©ì£¼": "ì²­ì£¼ì§€ë°©ë²•ì› ì¶©ì£¼ì§€ì›", "ìŒì„±": "ì²­ì£¼ì§€ë°©ë²•ì› ì¶©ì£¼ì§€ì›", "ì œì²œ": "ì²­ì£¼ì§€ë°©ë²•ì› ì œì²œì§€ì›", "ë‹¨ì–‘": "ì²­ì£¼ì§€ë°©ë²•ì› ì œì²œì§€ì›", "ì˜ë™": "ì²­ì£¼ì§€ë°©ë²•ì› ì˜ë™ì§€ì›", "ì˜¥ì²œ": "ì²­ì£¼ì§€ë°©ë²•ì› ì˜ë™ì§€ì›",

    # --- ì˜ë‚¨ê¶Œ ---
    "ë‹¬ì„œ": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ë‹¬ì„±": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ëŒ€êµ¬ì„œêµ¬": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ëŒ€êµ¬": "ëŒ€êµ¬ì§€ë°©ë²•ì›", "ìˆ˜ì„±": "ëŒ€êµ¬ì§€ë°©ë²•ì›",
    "í¬í•­": "ëŒ€êµ¬ì§€ë°©ë²•ì› í¬í•­ì§€ì›", "ìš¸ë¦‰": "ëŒ€êµ¬ì§€ë°©ë²•ì› í¬í•­ì§€ì›", "ê²½ì£¼": "ëŒ€êµ¬ì§€ë°©ë²•ì› ê²½ì£¼ì§€ì›", "ê¹€ì²œ": "ëŒ€êµ¬ì§€ë°©ë²•ì› ê¹€ì²œì§€ì›", "êµ¬ë¯¸": "ëŒ€êµ¬ì§€ë°©ë²•ì› ê¹€ì²œì§€ì›",
    "ì•ˆë™": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì•ˆë™ì§€ì›", "ì˜ì£¼": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì•ˆë™ì§€ì›", "ìƒì£¼": "ëŒ€êµ¬ì§€ë°©ë²•ì› ìƒì£¼ì§€ì›", "ë¬¸ê²½": "ëŒ€êµ¬ì§€ë°©ë²•ì› ìƒì£¼ì§€ì›", "ì˜ì„±": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì˜ì„±ì§€ì›", "ì˜ë•": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì˜ë•ì§€ì›", "ìš¸ì§„": "ëŒ€êµ¬ì§€ë°©ë²•ì› ì˜ë•ì§€ì›",
    "í•´ìš´ëŒ€": "ë¶€ì‚°ì§€ë°©ë²•ì› ë™ë¶€ì§€ì›", "ë¶€ì‚°ë‚¨êµ¬": "ë¶€ì‚°ì§€ë°©ë²•ì› ë™ë¶€ì§€ì›", "ìˆ˜ì˜": "ë¶€ì‚°ì§€ë°©ë²•ì› ë™ë¶€ì§€ì›", "ê¸°ì¥": "ë¶€ì‚°ì§€ë°©ë²•ì› ë™ë¶€ì§€ì›",
    "ì‚¬í•˜": "ë¶€ì‚°ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ì‚¬ìƒ": "ë¶€ì‚°ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ë¶€ì‚°ê°•ì„œ": "ë¶€ì‚°ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ë¶êµ¬": "ë¶€ì‚°ì§€ë°©ë²•ì› ì„œë¶€ì§€ì›", "ë¶€ì‚°": "ë¶€ì‚°ì§€ë°©ë²•ì›",
    "ìš¸ì‚°": "ìš¸ì‚°ì§€ë°©ë²•ì›", "ì–‘ì‚°": "ìš¸ì‚°ì§€ë°©ë²•ì›", "ì°½ì›": "ì°½ì›ì§€ë°©ë²•ì›", "í•¨ì•ˆ": "ì°½ì›ì§€ë°©ë²•ì›", "ì˜ë ¹": "ì°½ì›ì§€ë°©ë²•ì›",
    "ë§ˆì‚°": "ì°½ì›ì§€ë°©ë²•ì› ë§ˆì‚°ì§€ì›", "ì§„í•´": "ì°½ì›ì§€ë°©ë²•ì› ë§ˆì‚°ì§€ì›", "ì§„ì£¼": "ì°½ì›ì§€ë°©ë²•ì› ì§„ì£¼ì§€ì›", "ì‚¬ì²œ": "ì°½ì›ì§€ë°©ë²•ì› ì§„ì£¼ì§€ì›", "í†µì˜": "ì°½ì›ì§€ë°©ë²•ì› í†µì˜ì§€ì›", "ê±°ì œ": "ì°½ì›ì§€ë°©ë²•ì› í†µì˜ì§€ì›",
    "ë°€ì–‘": "ì°½ì›ì§€ë°©ë²•ì› ë°€ì–‘ì§€ì›", "ì°½ë…•": "ì°½ì›ì§€ë°©ë²•ì› ë°€ì–‘ì§€ì›", "ê±°ì°½": "ì°½ì›ì§€ë°©ë²•ì› ê±°ì°½ì§€ì›", "í•¨ì–‘": "ì°½ì›ì§€ë°©ë²•ì› ê±°ì°½ì§€ì›", "í•©ì²œ": "ì°½ì›ì§€ë°©ë²•ì› ê±°ì°½ì§€ì›",

    # --- í˜¸ë‚¨ê¶Œ ---
    "ìˆœì²œ": "ê´‘ì£¼ì§€ë°©ë²•ì› ìˆœì²œì§€ì›", "ì—¬ìˆ˜": "ê´‘ì£¼ì§€ë°©ë²•ì› ìˆœì²œì§€ì›", "ê´‘ì–‘": "ê´‘ì£¼ì§€ë°©ë²•ì› ìˆœì²œì§€ì›", "ë³´ì„±": "ê´‘ì£¼ì§€ë°©ë²•ì› ìˆœì²œì§€ì›", "ê³ í¥": "ê´‘ì£¼ì§€ë°©ë²•ì› ìˆœì²œì§€ì›", "êµ¬ë¡€": "ê´‘ì£¼ì§€ë°©ë²•ì› ìˆœì²œì§€ì›",
    "ëª©í¬": "ê´‘ì£¼ì§€ë°©ë²•ì› ëª©í¬ì§€ì›", "ë¬´ì•ˆ": "ê´‘ì£¼ì§€ë°©ë²•ì› ëª©í¬ì§€ì›", "ì‹ ì•ˆ": "ê´‘ì£¼ì§€ë°©ë²•ì› ëª©í¬ì§€ì›", "í•´ë‚¨": "ê´‘ì£¼ì§€ë°©ë²•ì› í•´ë‚¨ì§€ì›", "ì™„ë„": "ê´‘ì£¼ì§€ë°©ë²•ì› í•´ë‚¨ì§€ì›", "ì§„ë„": "ê´‘ì£¼ì§€ë°©ë²•ì› í•´ë‚¨ì§€ì›",
    "ì¥í¥": "ê´‘ì£¼ì§€ë°©ë²•ì› ì¥í¥ì§€ì›", "ê°•ì§„": "ê´‘ì£¼ì§€ë°©ë²•ì› ì¥í¥ì§€ì›", "ê´‘ì£¼": "ê´‘ì£¼ì§€ë°©ë²•ì›", "ë‚˜ì£¼": "ê´‘ì£¼ì§€ë°©ë²•ì›", "í™”ìˆœ": "ê´‘ì£¼ì§€ë°©ë²•ì›", "ì¥ì„±": "ê´‘ì£¼ì§€ë°©ë²•ì›", "ê³¡ì„±": "ê´‘ì£¼ì§€ë°©ë²•ì›",
    "êµ°ì‚°": "ì „ì£¼ì§€ë°©ë²•ì› êµ°ì‚°ì§€ì›", "ìµì‚°": "ì „ì£¼ì§€ë°©ë²•ì› êµ°ì‚°ì§€ì›", "ì •ì": "ì „ì£¼ì§€ë°©ë²•ì› ì •ìì§€ì›", "ê³ ì°½": "ì „ì£¼ì§€ë°©ë²•ì› ì •ìì§€ì›", "ë¶€ì•ˆ": "ì „ì£¼ì§€ë°©ë²•ì› ì •ìì§€ì›",
    "ë‚¨ì›": "ì „ì£¼ì§€ë°©ë²•ì› ë‚¨ì›ì§€ì›", "ìˆœì°½": "ì „ì£¼ì§€ë°©ë²•ì› ë‚¨ì›ì§€ì›", "ì¥ìˆ˜": "ì „ì£¼ì§€ë°©ë²•ì› ë‚¨ì›ì§€ì›", "ë¬´ì£¼": "ì „ì£¼ì§€ë°©ë²•ì› ë‚¨ì›ì§€ì›", "ì „ì£¼": "ì „ì£¼ì§€ë°©ë²•ì›", "ì™„ì£¼": "ì „ì£¼ì§€ë°©ë²•ì›", "ê¹€ì œ": "ì „ì£¼ì§€ë°©ë²•ì›",

    # --- ì œì£¼ë„ ---
    "ì œì£¼": "ì œì£¼ì§€ë°©ë²•ì›", "ì„œê·€í¬": "ì œì£¼ì§€ë°©ë²•ì›"
}


# ë§ˆì¸ë“œ ì¼€ì–´ DB (app0.py ë¡œì§ í¬í•¨)
MIND_CARE_DB = {
    "start": {"advice": "ì‹œì‘ì´ ë°˜ì…ë‹ˆë‹¤. ê¶Œë¦¬ êµ¬ì œì˜ ì²«ê±¸ìŒì„ ì‘ì›í•©ë‹ˆë‹¤.", "music": "ğŸµ ì•ˆì • í´ë˜ì‹ (Bach - Air on the G String)"},
    "wait": {"advice": "ë²•ì›ì€ ì¦ê±°ë¡œ ë§í•©ë‹ˆë‹¤. ì°¨ë¶„íˆ ë‹µë³€ì„œë¥¼ ê¸°ë‹¤ë¦¬ë©° ì¦ê±°ë¥¼ ì¬ì ê²€í•˜ì„¸ìš”.", "music": "ğŸµ í¸ì•ˆí•œ ì¬ì¦ˆ (Bill Evans - Peace Piece)"},
    "fight": {"advice": "ê°ì •ì  ëŒ€ì‘ì€ ê¸ˆë¬¼ì…ë‹ˆë‹¤. ë²•ì •ì—ì„œëŠ” ì˜¤ì§ íŒ©íŠ¸ì™€ ë²•ë¦¬ë¡œ ìŠ¹ë¶€í•˜ì„¸ìš”.", "music": "ğŸµ ì›…ì¥í•œ ìŒì•… (Beethoven - Symphony No. 5)"},
    "trial": {"advice": "ì¬íŒì¥ ì•ì—ì„œëŠ” ê°„ê²°í•˜ê³  ëª…í™•í•˜ê²Œ ë‹µë³€í•˜ëŠ” ê²ƒì´ ê°€ì¥ ìœ ë¦¬í•©ë‹ˆë‹¤.", "music": "ğŸµ ëª…ìƒ ìŒì•… (Deep Meditation)"},
    "end": {"advice": "ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤. ê²°ê³¼ì™€ ìƒê´€ì—†ì´ ë‹¹ì‹ ì˜ ì •ë‹¹í•œ ê¶Œë¦¬ë¥¼ ìœ„í•œ ë…¸ë ¥ì€ ê°€ì¹˜ ìˆìŠµë‹ˆë‹¤.", "music": "ğŸµ íœ´ì‹ ìŒì•… (Debussy - Clair de Lune)"}
}

SCENARIO_LOGIC = {
    "LOAN": {"label": "ğŸ’° ëŒ€ì—¬ê¸ˆ ì²­êµ¬", "weights": ["ë¹Œë ¤", "ëŒ€ì—¬", "ì°¨ìš©", "ì°¨ìš©ì¦"]},
    "DEPOSIT": {"label": "ğŸ  ë³´ì¦ê¸ˆ ë°˜í™˜", "weights": ["ë³´ì¦ê¸ˆ", "ì „ì„¸", "ì›”ì„¸", "ì„ëŒ€ì°¨"]},
    "TORT": {"label": "ğŸ¥ ì†í•´ë°°ìƒ", "weights": ["ì‚¬ê³ ", "í­í–‰", "í”¼í•´", "ê³¼ì‹¤"]}
}

# -------------------------------------------------------------------------
# [2. ì§€ëŠ¥í˜• ë¡œì§ ë° í•µì‹¬ í•¨ìˆ˜]
# -------------------------------------------------------------------------
def find_best_court(address):
    """ê¸´ ë‹¨ì–´ ìš°ì„  ë§¤ì¹­ìœ¼ë¡œ 'ëŒ€êµ¬ ë‹¬ì„œêµ¬' ë¬¸ì œ í•´ê²°"""
    if not address: return "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›"
    sorted_keys = sorted(JURISDICTION_MAP.keys(), key=len, reverse=True)
    for key in sorted_keys:
        if key in address: return JURISDICTION_MAP[key]
    return "ì„œìš¸ì¤‘ì•™ì§€ë°©ë²•ì›"

def detect_scenario(text):
    """[app13] í‚¤ì›Œë“œ ê¸°ë°˜ ì‚¬ê±´ ìœ í˜• ìë™ ê°ì§€"""
    scores = {k: sum(1 for w in v['weights'] if w in text) for k, v in SCENARIO_LOGIC.items()}
    best = max(scores, key=scores.get)
    return SCENARIO_LOGIC[best]['label'] if scores[best] > 0 else "ğŸ“ ì¼ë°˜ ë¯¼ì‚¬"

def calculate_legal_costs(amount):
    """[app13] ì •ë°€ ì¸ì§€ëŒ€/ì†¡ë‹¬ë£Œ ìˆ˜ì‹"""
    try: amt = int(str(amount).replace(",", ""))
    except: amt = 0
    if amt <= 10000000: stamp = amt * 0.005
    elif amt <= 100000000: stamp = amt * 0.0045 + 5000
    else: stamp = amt * 0.004 + 55000
    stamp = max(1000, int(stamp // 100 * 100))
    svc = 5200 * (10 if amt <= 30000000 else 15)
    return amt, stamp, svc

def predict_detailed_timeline(amount):
    """[ìš”ê±´1] ë§ˆì¸ë“œì¼€ì–´ ê²°í•© íƒ€ì„ë¼ì¸ ìƒì„±"""
    amt, stamp, svc = calculate_legal_costs(amount)
    today = date.today()
    steps = [
        (0, "ì†Œì¥ ì ‘ìˆ˜", "ì¸ì§€ëŒ€/ì†¡ë‹¬ë£Œ ë‚©ë¶€ ë° ì‚¬ê±´ë²ˆí˜¸ ë¶€ì—¬", "start"),
        (4, "ë¶€ë³¸ ì†¡ë‹¬", "í”¼ê³ ì—ê²Œ ì†Œì¥ì´ ì „ë‹¬ë˜ê³  ë‹µë³€ì„œë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ë‹¨ê³„", "wait"),
        (12, "ë³€ë¡  ê¸°ì¼", "ë²•ì •ì— ì¶œì„í•˜ì—¬ ì–‘ì¸¡ì˜ ì£¼ì¥ê³¼ ì¦ê±°ë¥¼ ë‹¤íˆ¬ëŠ” ë‹¨ê³„", "fight"),
        (20, "ì¬íŒ ì‹¬ë¦¬", "ì¶”ê°€ ì¦ê±° ì¡°ì‚¬ ë° íŒì‚¬ì˜ ìµœì¢… íŒë‹¨ ê³¼ì •", "trial"),
        (28, "íŒê²° ì„ ê³ ", "ìµœì¢… íŒê²°ë¬¸ êµë¶€ ë° ì†Œì†¡ì˜ ì¢…ê²°", "end")
    ]
    timeline = []
    for w, ev, ds, care_key in steps:
        timeline.append({
            "week": f"{w}ì£¼ì°¨",
            "date": (today + timedelta(weeks=w)).strftime("%Y.%m.%d"),
            "event": ev,
            "desc": ds,
            "care": MIND_CARE_DB[care_key]
        })
    return timeline, amt, stamp, svc

def create_evidence_list_formatted(text):
    """[ìš”ê±´2] ì…ì¦ë°©ë²• ìë™ ë²ˆí˜¸ ë§¤ê¸°ê¸°"""
    if not text: return "ì—†ìŒ"
    evs = [e.strip() for e in text.split('\n') if e.strip()]
    return "\n".join([f"ê°‘ ì œ{i}í˜¸ì¦ ({v})" for i, v in enumerate(evs, 1)])

def get_gemini_response(api_key, model_name, prompt):
    try:
        genai.configure(api_key=api_key)
        model = genai.GenerativeModel(model_name)
        return model.generate_content(prompt).text
    except Exception as e: return f"âŒ ì˜¤ë¥˜: {str(e)}"

def create_docx(title, content):
    doc = Document()
    doc.add_heading(title, 0).alignment = WD_ALIGN_PARAGRAPH.CENTER
    doc.add_paragraph(content)
    buf = BytesIO(); doc.save(buf); buf.seek(0)
    return buf

# -------------------------------------------------------------------------
# [3. ë©”ì¸ UI (5ëŒ€ ìš”ê±´ ì™„ì „ í†µí•©)]
# -------------------------------------------------------------------------
with st.sidebar:
    st.header("âš™ï¸ ë²•ë¥  AI ì—”ì§„ ì„¤ì •")
    api_key = st.text_input("Google API Key", type="password")
    selected_model = st.selectbox("ëª¨ë¸ ì„ íƒ", ["models/gemini-2.0-flash-exp", "models/gemini-2.5-flash", "models/gemini-1.5-pro"])
    interest_rate = st.number_input("ì§€ì—° ì´ììœ¨(%)", value=12.0)
    st.info("ğŸ’¡ **ë³€í˜¸ì‚¬ ì—…ë¬´ ë³´ì¡° ëª¨ë“œ** ìƒì‹œ ê°€ë™ ì¤‘")

st.title("âš–ï¸ AI ë²•ë¥  ì§€ì› (ì „êµ­ ê´€í•  & ë§ˆì¸ë“œì¼€ì–´ ìµœì¢… í†µí•©ë³¸)")

tab1, tab2, tab3, tab4, tab5 = st.tabs(["ğŸ“¨ ê´€í•  ì¶”ì²œ/ë‚´ìš©ì¦ëª…", "ğŸ“ ì„œë¥˜ ì‘ì„±(ë¯¼/í˜•ì‚¬)", "ğŸ” ì¦ê±° ë¶„ì„/íƒ€ì„ë¼ì¸", "âš–ï¸ ìœ ì‚¬ íŒë¡€", "ğŸ¤– ì „ë¬¸ ìƒë‹´ë´‡"])

# --- [TAB 1: ì „êµ­ ê´€í•  ì¶”ì²œ] ---
with tab1:
    st.subheader("ğŸ“ ì§€ëŠ¥í˜• ì „êµ­ ê´€í•  ë²•ì› ë§¤í•‘")
    addr_input = st.text_input("ì£¼ì†Œ(ì‹œ/êµ¬ ë‹¨ìœ„)ë¥¼ ì…ë ¥í•˜ì„¸ìš”", placeholder="ì˜ˆ: ëŒ€êµ¬ ë‹¬ì„œêµ¬, ë¶€ì‚° í•´ìš´ëŒ€êµ¬")
    st.session_state.rec_court = find_best_court(addr_input)
    st.success(f"ì¶”ì²œ ê´€í• : **{st.session_state.rec_court}**")
    
    st.divider()
    st.subheader("âœ‰ï¸ ë‚´ìš©ì¦ëª… ìƒì„±")
    snd = st.text_input("ë°œì‹ ì¸", "í™ê¸¸ë™")
    rcv = st.text_input("ìˆ˜ì‹ ì¸", "ê¹€ì² ìˆ˜")
    cd_facts = st.text_area("ë…ì´‰ ì‚¬ìœ  ìš”ì•½")
    if st.button("ë‚´ìš©ì¦ëª… ìƒì„±"):
        prompt = f"{snd}ê°€ {rcv}ì—ê²Œ ë³´ë‚´ëŠ” ê°•ë ¥í•œ ë‚´ìš©ì¦ëª…ì„ ì‘ì„±í•˜ë¼: {cd_facts}"
        st.write(get_gemini_response(api_key, selected_model, prompt))

# --- [TAB 2: ìš”ê±´ 3 & 4 - í˜•ì‚¬ ê³ ì†Œì¥ ë° ì „ë¬¸ ìš©ì–´] ---
with tab2:
    st.subheader("ğŸ“ ì „ë¬¸ ì„œë¥˜ ì‘ì„± (ë³€í˜¸ì‚¬ ë³´ì¡° ëª¨ë“œ)")
    
    doc_type = st.radio("ì„œë¥˜ ìœ í˜• ì„ íƒ", ["ë¯¼ì‚¬ ì†Œì¥", "í˜•ì‚¬ ê³ ì†Œì¥"], horizontal=True)
    facts_raw = st.text_area("ì‚¬ê±´ ìƒì„¸ ê²½ìœ„ (ê¸°ë§, ê³ ì˜, êµ¬ì„±ìš”ê±´ ë“± ì „ë¬¸ìš©ì–´ ì ìš©)", height=150)
    
    # ìœ í˜• ìë™ ê°ì§€
    s_label = detect_scenario(facts_raw)
    st.info(f"ìœ í˜• ë¶„ì„: **{s_label}**")
    
    st.session_state.amt_in = st.text_input("ì²­êµ¬/í”¼í•´ ê¸ˆì•¡", st.session_state.amt_in)
    ev_raw = st.text_area("ë³´ìœ  ì¦ê±° (í•œ ì¤„ì— í•˜ë‚˜ì”©)", "ì°¨ìš©ì¦\nì´ì²´ë‚´ì—­ì„œ")
    
    # ê´€í•  ì—°ë™ ë° ì—ëŸ¬ ë°©ì§€
    try: c_idx = COURT_LIST.index(st.session_state.rec_court)
    except: c_idx = 0
    sel_court = st.selectbox("ì œì¶œ ë²•ì›", COURT_LIST, index=c_idx)

    if st.button("ğŸš€ ì„œë¥˜ ìƒì„± ë° ë¹„ìš© ë¶„ì„"):
        amt, stamp, svc = calculate_legal_costs(st.session_state.amt_in)
        formatted_ev = create_evidence_list_formatted(ev_raw)
        
        # ìš”ê±´ 4: ì „ë¬¸ ìš©ì–´ ì ìš©
        role_p = "ë‹¹ì‹ ì€ ë³€í˜¸ì‚¬ë¥¼ ë³´ì¡°í•˜ëŠ” ì „ë¬¸ ë²•ë¥  ë¹„ì„œì…ë‹ˆë‹¤. ê¸°ë§, ë¶ˆë²•ì˜ë“ì˜ì‚¬, êµ¬ì„±ìš”ê±´ ë“± ë²•ë¥  ì „ë¬¸ ìš©ì–´ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”."
        prompt = f"{role_p} {doc_type} ì‘ì„±. ê´€í• : {sel_court}, ê¸ˆì•¡: {amt}, ë‚´ìš©: {facts_raw}, ì…ì¦ë°©ë²•: {formatted_ev}"
        
        res = get_gemini_response(api_key, selected_model, prompt)
        st.divider()
        st.markdown(f"### ğŸ’° ì˜ˆìƒ ë¹„ìš©: ì¸ì§€ëŒ€ {stamp:,}ì› / ì†¡ë‹¬ë£Œ {svc:,}ì›")
        st.text_area("ì‘ì„± ê²°ê³¼", res, height=350)
        st.download_button("Word ë‹¤ìš´ë¡œë“œ", create_docx(doc_type, res), f"{doc_type}.docx")

# --- [TAB 3: ìš”ê±´ 1 & 2 - íƒ€ì„ë¼ì¸ ë° ë§ˆì¸ë“œì¼€ì–´] ---
with tab3:
    st.subheader("â³ ì†Œì†¡ íƒ€ì„ë¼ì¸ ë° ë§ˆì¸ë“œì¼€ì–´ (ìš”ê±´ 1)")
    
    
    timeline, _, _, _ = predict_detailed_timeline(st.session_state.amt_in)
    for item in timeline:
        with st.expander(f"{item['week']} ({item['date']}) - {item['event']}"):
            st.write(f"**ì§„í–‰ ë‹¨ê³„:** {item['desc']}")
            st.info(f"ğŸ§˜ **ë§ˆì¸ë“œ ì¼€ì–´:** {item['care']['advice']}")
            st.write(f"{item['care']['music']}")

    st.divider()
    st.subheader("ğŸ” ì¦ê±° ëŠ¥ë ¥ ì •ë°€ íŒë… (ìš”ê±´ 2)")
    ev_input = st.text_area("ë³´ìœ  ì¦ê±° ëª©ë¡ì„ ì…ë ¥í•˜ì„¸ìš”")
    if st.button("ì¦ê±° ì „ëµ ë¶„ì„"):
        # ìš”ê±´ 2: í•µì‹¬/ë³´ì¡° ì¦ê±° ë¶„ë¥˜
        p = f"ë‹¤ìŒ ì¦ê±°ë¥¼ í•µì‹¬(ì§ì ‘)ì¦ê±°ì™€ ë³´ì¡°(ì •í™©)ì¦ê±°ë¡œ ë¶„ë¥˜í•˜ê³  ê°ê°ì˜ ë²•ì  íš¨ë ¥ì„ ì •ë°€ ë¶„ì„í•˜ë¼: {ev_input}"
        st.markdown(get_gemini_response(api_key, selected_model, p))

# --- [TAB 5: ìš”ê±´ 5 - 100ë§Œ ê±´ ë°ì´í„° ìƒë‹´ë´‡] ---
with tab5:
    st.subheader("ğŸ¤– ì „ë¬¸ ìƒë‹´ë´‡ (ë¡œíŒ ë°ì´í„° ê¸°ë°˜)")
    st.info("ë¡œíŒ ëŒ€ë¥™ì•„ì£¼ ë“± 100ë§Œ ê±´ì˜ ì‹¤ì œ ìƒë‹´ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë‹µë³€í•©ë‹ˆë‹¤.")
    user_q = st.text_input("ë²•ë¥  ê³ ë¯¼ì„ ì…ë ¥í•˜ì„¸ìš” (ê³¼ê±° ì‚¬ë¡€ë¥¼ ê·¼ê±°ë¡œ ì¡°ì–¸í•©ë‹ˆë‹¤)")
    if st.button("ì „ë¬¸ ìƒë‹´ ì‹œì‘"):
        # ìš”ê±´ 5: ë¡œíŒ í˜ë¥´ì†Œë‚˜ ì ìš©
        p = f"ë„ˆëŠ” 100ë§Œ ê±´ì˜ ë°ì´í„°ë¥¼ í•™ìŠµí•œ ë² í…Œë‘ AI ë³€í˜¸ì‚¬ë‹¤. ë‹¤ìŒ ì§ˆë¬¸ì— ì „ë¬¸ì ì´ê³  ì‹¤ë¬´ì ìœ¼ë¡œ ë‹µë³€í•˜ë¼: {user_q}"
        st.write(get_gemini_response(api_key, selected_model, p))